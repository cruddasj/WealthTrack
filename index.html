<!doctype html>
<html lang="en" class="min-h-full bg-gray-100 dark:bg-gray-900">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WealthTrack</title>
    <meta name="theme-color" content="#111827" />
    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="icon" href="assets/icons/app-logo.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="assets/icons/app-logo.svg" />

    <!-- Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Font Awesome for icons -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      rel="stylesheet"
    />

    <!-- App styles -->
    <link rel="stylesheet" href="assets/styles.css" />

    <!-- Chart libs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    

    <!-- Component classes moved to assets/styles.css -->
  </head>

  <body
    class="min-h-screen flex flex-col md:flex-row bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200"
    style="min-height: 100vh; min-height: 100dvh;"
  >
    <!-- SVG sprite: app logo + small icons -->
    <svg aria-hidden="true" width="0" height="0" style="position: absolute">
      <defs>
        <symbol id="app-logo" viewBox="200 100 600 600">
          <!-- original complex logo paths, defined once -->
          <g transform="translate(0,-48)">
            <path
              d="M587.900757,611.713379 C582.531250,617.927246 576.260925,620.500854 568.486694,618.308960 C561.069336,616.217651 557.079529,611.054565 556.165894,603.598694 C555.788025,600.515076 554.164429,599.443726 551.471436,598.752075 C520.039001,590.679199 488.618103,582.560791 457.215668,574.371948 C454.213562,573.589111 452.225494,573.766846 449.922821,576.451599 C445.991608,581.034973 440.422089,582.590454 434.495728,581.379456 C431.218231,580.709717 429.376495,581.611633 427.431824,584.246216 C408.432831,609.985718 389.319183,635.640808 370.175354,661.273071 C368.530060,663.476013 368.064545,665.370178 369.049316,668.119873 C371.345184,674.530640 369.260193,681.311523 364.455841,684.679382 C359.644836,688.051819 352.723969,687.924805 348.059021,684.378723 C343.302795,680.763184 341.368561,673.930054 343.471436,668.172119 C345.687988,662.102905 351.039673,658.641541 358.035614,659.301758 C360.487213,659.533142 361.704163,658.631592 362.977112,656.907349 C382.276489,630.765259 401.589783,604.633423 420.963409,578.546387 C422.461304,576.529358 422.586121,574.962585 421.337860,572.708862 C417.547241,565.864746 418.226562,559.069580 423.169403,553.156799 C427.658356,547.786987 433.687012,545.669617 440.688843,547.350647 C448.283905,549.174072 452.817108,554.066040 454.171478,561.700195 C454.565674,563.922119 455.126160,565.228271 457.548645,565.852844 C488.006470,573.705811 518.436096,581.668030 548.877258,589.585876 C549.312073,589.698914 549.802002,589.599976 551.272644,589.599976 C534.485657,577.505920 518.423523,565.961670 502.406586,554.354980 C500.673767,553.099243 499.434418,553.882263 497.861359,554.606323 C485.694794,560.206604 473.420807,551.944885 474.209869,538.547485 C474.362335,535.958984 473.597321,534.490906 471.700073,533.127991 C464.798126,528.169922 457.906921,523.196228 451.062256,518.159668 C449.133301,516.740295 447.370148,516.209656 445.154816,517.624939 C443.323059,518.795288 441.153259,519.710144 438.990509,519.315491 C433.354706,518.287048 430.712341,521.429321 428.091583,525.769592 C420.514099,538.318665 412.604736,550.668823 404.712921,563.025146 C403.251373,565.313477 402.831055,567.166321 403.907898,569.903442 C406.752350,577.133728 403.054718,584.201843 395.969086,585.948914 C389.718170,587.490112 383.287354,583.043579 381.999146,576.289612 C380.688232,569.416260 385.629333,563.214111 393.155914,562.804871 C395.931152,562.653992 397.302277,561.400879 398.618042,559.280762 C406.964783,545.831238 415.351990,532.406433 423.832001,519.040710 C425.168823,516.933716 425.391144,515.585022 423.616669,513.416382 C417.723969,506.214691 417.610321,497.785248 422.867310,490.898010 C427.359436,485.012878 436.639282,482.692169 443.724701,485.682007 C451.370544,488.908386 455.705566,496.411438 454.207886,505.203217 C453.597412,508.786926 454.502533,510.655762 457.321777,512.567139 C463.525665,516.773315 469.562439,521.230408 475.591492,525.687744 C477.957611,527.437012 479.885376,527.820557 482.777893,526.235596 C493.760925,520.217468 506.508636,527.859619 506.199371,540.453857 C506.080170,545.309631 507.797516,548.001221 511.538452,550.628601 C527.354797,561.736816 543.007080,573.079163 558.680786,584.389404 C561.284729,586.268433 563.637939,587.298340 566.863098,585.437988 C569.285400,584.040649 572.293152,583.317078 575.084473,584.223816 C579.031250,585.505920 581.171143,583.857788 583.320862,580.738342 C604.028259,550.689758 624.810669,520.692627 645.656372,490.739746 C657.743225,473.372528 669.941284,456.082092 682.211731,438.844208 C683.759644,436.669556 684.112549,435.137573 682.762390,432.638580 C679.447266,426.502563 680.630310,420.311523 685.452637,415.817535 C690.146057,411.443695 697.269775,410.832245 703.059387,414.306183 C707.978210,417.257660 710.484497,423.613617 709.071411,429.552765 C707.584167,435.803406 702.455322,440.225830 695.684998,440.201935 C692.145569,440.189453 690.291687,441.643402 688.446838,444.310608 C660.867310,484.185944 633.214783,524.010864 605.574097,563.843933 C600.159607,571.646729 594.753845,579.456055 589.273010,587.212158 C587.949585,589.084900 587.101929,590.580750 588.561340,593.001038 C592.252197,599.121826 591.871216,605.359314 587.900757,611.713379 z"
            />
            <path
              d="M645.847168,406.794556 C623.373108,446.181458 601.090149,485.254822 578.769653,524.306824 C577.237671,526.987183 576.201904,529.162659 578.139648,532.468567 C582.468933,539.854553 581.307434,547.820923 575.833069,553.714417 C570.880127,559.046631 561.875061,560.710632 555.058655,557.553223 C548.149902,554.353027 544.321228,547.064697 545.381897,538.509155 C545.677185,536.127625 544.923218,534.767151 543.098389,533.511353 C510.156647,510.840851 477.222290,488.159454 444.328888,465.418915 C441.928741,463.759552 439.966888,463.682220 437.557190,465.360962 C434.249786,467.665100 430.331207,468.304565 426.548584,467.238678 C423.155609,466.282623 421.468079,467.516235 419.583557,470.087219 C397.816528,499.783447 375.950378,529.407043 354.103485,559.044678 C352.225830,561.591919 350.354614,564.147217 348.381348,566.619690 C344.879486,571.007568 342.251343,574.836487 344.106537,581.562317 C346.434143,590.000793 339.057587,597.661011 330.316010,598.050476 C322.826385,598.384216 315.930481,591.628052 315.807556,583.836060 C315.678009,575.627808 322.432068,569.004700 331.071838,569.522095 C334.432587,569.723389 336.276154,568.595215 338.109589,566.109802 C362.640991,532.855530 387.233917,499.646698 411.812103,466.426971 C413.705780,463.867493 415.306000,461.782440 413.102203,458.039551 C409.033722,451.129639 410.303253,444.032440 415.479858,438.117188 C420.205231,432.717529 426.422333,430.528168 433.549927,432.709381 C441.410980,435.115051 445.866272,440.910248 446.304718,449.292755 C446.440460,451.888184 447.421356,453.128387 449.803528,453.970123 C473.193451,462.235199 496.557129,470.574738 519.911133,478.940826 C521.975525,479.680328 523.649902,479.796600 525.343933,478.053131 C529.278381,474.003845 534.277344,472.812927 539.597412,473.984741 C542.463379,474.616058 543.927917,473.548492 545.472534,471.582458 C563.897095,448.130676 582.338684,424.692261 600.818176,401.283875 C602.316406,399.386047 602.560913,397.716705 601.698547,395.355835 C599.885498,390.392548 601.822327,384.864807 605.874329,382.085693 C610.139954,379.160034 615.172546,379.371216 619.326416,382.650177 C623.316223,385.799591 624.809204,391.331512 622.975342,396.170654 C621.137268,401.021179 617.018005,403.876862 611.589966,403.152374 C608.536499,402.744843 607.115479,403.894714 605.450745,406.050049 C587.425659,429.387238 569.333923,452.673218 551.176819,475.907867 C549.480835,478.078156 548.881104,479.765778 550.019714,482.588531 C553.597595,491.459076 549.752686,500.274445 541.526550,503.027283 C532.428162,506.071991 524.094971,501.528046 521.647766,491.898987 C520.903320,488.969696 519.521179,487.382050 516.668091,486.407959 C499.674011,480.605957 482.732361,474.650421 464.835754,468.420135 C468.558899,472.246429 472.328583,474.456207 475.885620,476.917603 C499.451324,493.224640 523.069214,509.456726 546.567871,525.859619 C549.430542,527.857849 551.560974,528.218567 554.518921,526.144348 C557.267029,524.217163 560.736328,523.213989 564.051758,523.911133 C568.026978,524.747009 569.751526,522.877075 571.483765,519.819519 C587.826355,490.972778 604.200989,462.143707 620.698486,433.385315 C635.289673,407.949860 650.009155,382.587555 664.791687,357.262787 C666.391785,354.521576 666.691040,352.458984 665.042664,349.534271 C661.516357,343.277527 662.631226,336.811554 667.413086,332.184540 C671.860840,327.880859 678.510620,327.084869 684.022705,330.196289 C689.662415,333.379761 692.553467,339.996887 691.125732,346.454163 C689.748840,352.681793 684.533875,356.883179 677.143188,356.943787 C674.199890,356.967926 673.484985,358.735931 672.438904,360.551178 C663.621460,375.851257 654.829163,391.165802 645.847168,406.794556 z"
            />
            <path
              d="M351.283569,612.216187 C361.176727,615.257935 366.089233,623.527161 363.727631,632.613647 C361.539124,641.033997 353.371582,646.354858 345.235413,644.660583 C335.763916,642.688232 330.335876,634.810303 331.786469,625.141541 C333.129120,616.192200 340.613281,611.078552 351.283569,612.216187 z"
            />
            <path
              d="M580.933899,463.609802 C580.774170,458.784332 582.511047,455.803009 587.319641,455.690369 C591.036011,455.603271 593.212463,457.809631 593.712524,461.304993 C594.257202,465.112823 592.344238,467.735870 588.635315,468.609711 C584.773865,469.519501 582.376587,467.493103 580.933899,463.609802 z"
            />
            <path
              d="M624.820068,486.184692 C620.538818,486.240936 618.184265,484.247253 617.514038,480.526031 C616.955505,477.425018 618.387939,475.074402 621.105774,473.571075 C623.810120,472.075226 626.284546,472.894257 628.366577,474.782501 C632.091858,478.160950 630.615784,483.317688 624.820068,486.184692 z"
            />
            <path
              d="M391.873718,527.048096 C390.763000,523.225403 391.684784,520.437134 394.838593,518.588684 C397.055603,517.289307 399.327179,517.486511 401.432251,518.902344 C403.928925,520.581665 404.667267,523.046143 404.150177,525.890869 C403.688965,528.427917 402.036316,530.017212 399.609741,530.686279 C396.250580,531.612366 393.812439,530.197021 391.873718,527.048096 z"
            />
            <path
              d="M376.900909,547.086853 C377.782318,542.789551 379.997437,540.384094 384.199707,540.901733 C387.570831,541.316895 389.516357,543.626709 389.778229,546.937622 C390.044281,550.300964 388.250214,552.625793 385.082672,553.702576 C381.271088,554.998474 378.415314,552.776794 376.900909,547.086853 z"
            />
            <path
              d="M602.566406,534.441406 C599.350708,538.046082 596.109924,537.610718 593.234192,534.897156 C590.414062,532.236206 590.554688,528.900452 592.847473,525.955811 C594.970642,523.229004 598.030029,522.828308 600.818420,524.668274 C604.375671,527.015564 605.023621,530.370178 602.566406,534.441406 z"
            />
            <path
              d="M608.817993,496.823425 C612.989502,497.971619 614.722839,500.513824 614.136597,504.368530 C613.728210,507.053802 612.175964,508.960663 609.283020,509.295197 C605.448608,509.738586 602.707031,508.274719 601.860535,504.350220 C601.046753,500.577240 603.557007,497.804993 608.817993,496.823425 z"
            />
            <path
              d="M534.781982,435.590393 C537.792664,430.259430 540.605591,428.946350 543.762695,431.355835 C546.098206,433.138245 547.823364,435.435760 546.535767,438.637238 C545.336548,441.619019 542.936157,443.089111 539.812378,442.551880 C536.287476,441.945679 534.220398,439.814392 534.781982,435.590393 z"
            />
          </g>
        </symbol>

        <symbol id="i-edit" viewBox="0 0 24 24">
          <path
            d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0L15.13 4.12l3.75 3.75 1.83-1.83z"
          />
        </symbol>
        <symbol id="i-bin" viewBox="0 0 24 24">
          <path
            d="M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"
          />
        </symbol>
      </defs>
    </svg>

    <!-- Mobile Header -->
    <div
      class="md:hidden flex items-center justify-start gap-4 p-4 bg-white dark:bg-gray-800 shadow-md"
    >
      <button id="menu-toggle" class="text-gray-900 dark:text-gray-100">
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16m-7 6h7"
          />
        </svg>
      </button>
      <div class="flex items-center">
        <svg
          class="h-10 w-10 mr-2 text-gray-800 dark:text-white -mt-2"
          fill="currentColor"
        >
          <use href="#app-logo" />
        </svg>
        <h1 class="text-xl font-bold text-gray-900 dark:text-gray-100">
          WealthTrack
        </h1>
      </div>
    </div>

    <!-- Sidebar -->
    <div
      id="sidebar"
      class="fixed inset-y-0 left-0 w-64 bg-white dark:bg-gray-800 p-6 flex flex-col items-center shadow-lg border-r border-gray-200 dark:border-gray-700 overflow-y-auto md:overflow-visible transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300 ease-in-out z-40 md:min-h-screen"
      style="min-height: 100vh; min-height: 100dvh;"
    >
      <div class="mb-8 w-full">
        <button
          id="brandHome"
          class="flex flex-col items-center w-full cursor-pointer"
        >
          <svg
            id="brandLogo"
            class="text-gray-800 dark:text-white mb-1 -mt-8"
            fill="currentColor"
            style="height: auto"
          >
            <use href="#app-logo" />
          </svg>
          <h1
            id="brandTitle"
            class="text-2xl leading-none font-bold text-center text-gray-900 dark:text-gray-100"
          >
            WealthTrack
          </h1>
        </button>
      </div>

      <div class="mb-8">
        <label class="dark-mode-toggle">
          <span class="mr-3 font-semibold text-gray-500 dark:text-gray-400"
            >Dark Mode</span
          >
          <input type="checkbox" id="themeToggle" class="peer" />
          <span class="toggle-track"><span class="toggle-thumb"></span></span>
        </label>
      </div>

      <nav class="w-full">
        <button class="nav-btn" data-target="welcome">
          <span class="flex items-center">
            <i class="fa-solid fa-circle-info h-5 w-5 mr-3"></i>
            Welcome
          </span>
        </button>
        <button class="nav-btn active-nav-button" data-target="data-entry">
          <span class="flex items-center">
            <i class="fa-solid fa-clipboard-list h-5 w-5 mr-3"></i>
            Assets & Goals
          </span>
        </button>
        <button class="nav-btn hidden" data-target="forecasts">
          <span class="flex items-center">
            <i class="fa-solid fa-chart-line h-5 w-5 mr-3"></i>
            Forecasts
          </span>
        </button>
        <button class="nav-btn hidden" data-target="portfolio-analysis">
          <span class="flex items-center">
            <i class="fa-solid fa-chart-pie h-5 w-5 mr-3"></i>
            Portfolio Insights
          </span>
        </button>
        <button class="nav-btn hidden" data-target="snapshots">
          <span class="flex items-center">
            <i class="fa-solid fa-camera h-5 w-5 mr-3"></i>
            Snapshots
          </span>
        </button>
        <button class="nav-btn" data-target="calculators">
          <span class="flex items-center">
            <i class="fa-solid fa-calculator h-5 w-5 mr-3"></i>
            Calculators
          </span>
        </button>
        <button class="nav-btn" data-target="settings">
          <span class="flex items-center">
            <i class="fa-solid fa-sliders-h h-5 w-5 mr-3"></i>
            Settings & Data
          </span>
        </button>
      </nav>
    </div>

    <div
      id="overlay"
      class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden"
    ></div>

    <main class="flex-1 p-4 md:p-8 overflow-y-auto overflow-x-hidden">
      <div id="welcome" class="content-section">
        <h2 class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-6">
          Welcome to WealthTrack
        </h2>
        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">Welcome</h3>
          <p class="text-gray-700 dark:text-gray-300 mb-4">
            WealthTrack helps you project and protect your financial future by
            combining the value of your current assets, recurring contributions,
            and growth assumptions. You can run "what-if" events, estimate
            future asset values, and save snapshots to track progress on the
            path to your financial goals.
          </p>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="p-4 rounded-lg bg-gray-100 dark:bg-gray-700 stat-box">
              <h4 class="font-semibold text-gray-900 dark:text-gray-100 mb-2">Quick start</h4>
              <ul class="list-disc pl-5 text-gray-700 dark:text-gray-300">
                <li>Create multiple profiles to keep scenarios separate (e.g., Personal, Partner, Joint, Experiments).</li>
                <li>Add your assets on the Assets & Goals page. The Forecasts tab unlocks once you have financial data, and setting a wealth goal adds goal-focused insights. Portfolio Insights shows up after you add your first asset.</li>
                <li>Set expected growth rates to power projections.</li>
                <li>Estimate future asset values from the Portfolio Insights page.</li>
                <li>Add future one-off events to simulate gains/losses.</li>
                <li>Run stress tests from Portfolio Insights to see how random market events could impact your projections.</li>
                <li>Save snapshots and review your history on the Snapshots page.</li>
              </ul>
            </div>

            <div class="p-4 rounded-lg bg-gray-100 dark:bg-gray-700 stat-box">
              <h4 class="font-semibold text-gray-900 dark:text-gray-100 mb-2">Where to find things</h4>
              <ul class="list-disc pl-5 text-gray-700 dark:text-gray-300">
                <li><b>Profiles</b>: manage and switch profiles from the <b>Settings & Data</b> page.</li>
                <li><b>Assets & Goals</b>: capture assets, liabilities, and goals.</li>
                <li><b>Forecasts</b>: run projections, simulate one-off events, and use the Progress Check card to compare against snapshots.</li>
                <li><b>Portfolio Insights</b>: see allocation, passive income, future asset values, stress testing, and inflation impact.</li>
                <li><b>Snapshots</b>: save your totals and review how your wealth has changed over time.</li>
                <li><b>Calculators</b>: run one-off financial calculations.</li>
                <li><b>Settings & Data</b>: update theme, manage profiles, and export/import your data (optional password protection).</li>
              </ul>
            </div>
          </div>

          <div class="mt-4 p-4 rounded-lg bg-gray-100 dark:bg-gray-700 stat-box">
            <h4 class="font-semibold text-gray-900 dark:text-gray-100 mb-2">Try a demo</h4>
            <p class="text-sm text-gray-700 dark:text-gray-300 mb-3">Load sample data to explore forecasts and insights in seconds.</p>
            <button class="btn btn-purple" data-action="load-demo" aria-label="Load demo data">Load Demo Data</button>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">Demo data creates a sample profile you can delete anytime.</p>
          </div>

          <div class="mt-4 p-4 rounded-lg bg-gray-100 dark:bg-gray-700 stat-box">
            <h4 class="font-semibold text-gray-900 dark:text-gray-100 mb-2">Use Profiles</h4>
            <p>
              Create unique profiles (for example, Personal vs. Joint or different strategies) and switch them from the
              <b>Settings & Data</b> page. Your assets, events, and goals stay separate per profile.
            </p>
            <div class="mt-3">
              <button class="btn btn-blue" data-action="create-profile" aria-label="Create a profile">Create a Profile</button>
            </div>
          </div>

          <div class="mt-6 flex gap-2">
            <button id="startNowBtn" data-action="start-now" class="btn btn-green" aria-label="Start now">Start Now</button>
          </div>
        </div>
      </div>

      <div id="data-entry" class="content-section active">
        <h2 class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-6">
          Assets & Goals
        </h2>
        <div
          class="mb-6 p-4 rounded-lg bg-gray-100 dark:bg-gray-700 stat-box text-gray-700 dark:text-gray-300"
          data-first-time
        >
          <p class="text-sm">
            The data you enter here powers your projections and analysis. Add
            assets, liabilities, and a wealth goal with a target year to drive your Forecasts and
            Portfolio Insights.
          </p>
        </div>

        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">Goals</h3>
          <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
            Set a wealth goal and target year to work toward.
          </p>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div
              class="flex flex-col items-center justify-center p-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 stat-box"
            >
              <label
                for="goalValue"
                class="text-md font-medium text-gray-700 dark:text-gray-300"
                >Wealth Goal (<span data-currency-symbol>£</span>)</label
              >
              <input
                type="number"
                step="any"
                id="goalValue"
                placeholder="e.g. 1000000"
                class="text-center text-3xl font-bold mt-2 bg-transparent border-b-2 border-gray-400 dark:border-gray-500 focus:outline-none focus:border-blue-500 w-full"
              />
            </div>
            <div
              class="flex flex-col items-center justify-center p-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 stat-box"
            >
              <label
                for="goalYear"
                class="text-md font-medium text-gray-700 dark:text-gray-300"
                >Target Year</label
              >
              <input
                type="number"
                id="goalYear"
                placeholder="e.g. 2050"
                class="text-center text-3xl font-bold mt-2 bg-transparent border-b-2 border-gray-400 dark:border-gray-500 focus:outline-none focus:border-blue-500 w-full"
              />
            </div>
            <div class="md:col-span-2">
              <button id="goalBtn" class="btn btn-green btn-block">Set</button>
            </div>
          </div>
        </div>

        <div class="card transition">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">Assets & Contributions</h3>
          <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
            Add assets and recurring deposits, then set growth assumptions to
            project your future wealth.
          </p>

          <form id="assetForm" class="grid grid-cols-1 md:gap-4 gap-2">
            <div class="md:col-span-full">
              <label for="assetName" class="form-label required-label"
                >Asset Name</label
              >
              <input
                type="text"
                id="assetName"
                placeholder="e.g. Stocks"
                class="input-field"
                required
              />
            </div>
            <div class="md:col-span-full">
              <label for="assetValue" class="form-label required-label"
                >Value (<span data-currency-symbol>£</span>)</label
              >
              <input
                type="number"
                step="any"
                id="assetValue"
                placeholder="e.g. 50000"
                class="input-field"
                required
              />
            </div>
            <div class="md:col-span-full">
              <label for="depositAmount" class="form-label"
                >Deposit Amount (<span data-currency-symbol>£</span>)</label
              >
              <input
                type="number"
                step="any"
                id="depositAmount"
                value="0"
                class="input-field"
              />
            </div>
            <div class="md:col-span-full">
              <label for="depositFrequency" class="form-label"
                >Deposit Frequency</label
              >
              <select id="depositFrequency" class="input-field">
                <option value="none">None</option>
                <option value="monthly">Monthly</option>
                <option value="quarterly">Quarterly</option>
                <option value="yearly">Yearly</option>
              </select>
            </div>

            <div class="md:col-span-full">
              <label for="assetStartDate" class="form-label"
                >Start Date</label
              >
              <input type="date" id="assetStartDate" class="input-field" />
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                Leave blank to start immediately. Forecasts and contributions
                begin on the selected date.
              </p>
            </div>

            <!-- Include in Passive Income toggle (moved below deposit frequency) -->
            <div class="md:col-span-full">
              <label class="form-label"
                >Include in Passive Income estimates</label
              >
              <label class="dark-mode-toggle">
                <input type="checkbox" id="includePassive" checked />
                <span class="toggle-track"
                  ><span class="toggle-thumb"></span
                ></span>
              </label>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                If off, this asset will be excluded from Estimated Passive
                Income on the Portfolio Insights page.
              </p>
            </div>

            <div class="md:col-span-full">
              <label for="assetTaxTreatment" class="form-label">
                Tax treatment for UK forecasts
              </label>
              <select id="assetTaxTreatment" class="input-field">
                <option value="tax-free">Tax-free or sheltered (ISA, pension)</option>
                <option value="income">Taxed as income (interest, rent, bond coupons)</option>
                <option value="dividend">Taxed as dividends</option>
                <option value="capital-gains">Capital gains tax on sale</option>
              </select>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                Determines how this asset uses your UK allowances and tax band in
                projections. Adjust the defaults from the Settings page.
              </p>
            </div>

            <div
              class="grid grid-cols-1 md:grid-cols-3 gap-2 md:gap-4 md:col-span-full"
            >
              <div>
                <label for="lowGrowth" class="form-label">
                  Low Growth Annual Return (%)
                  <span
                    class="relative group inline-block align-middle ml-1 cursor-help"
                  >
                    <span class="text-gray-400">?</span>
                    <span
                      class="hidden group-hover:block absolute z-50 mt-2 w-64 p-3 rounded-lg shadow bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm"
                    >
                      Optional. Used for conservative future forecasts (lower
                      expected returns).
                    </span>
                  </span>
                </label>
                <input
                  type="number"
                  step="any"
                  id="lowGrowth"
                  placeholder="e.g. 1"
                  class="input-field"
                />
              </div>

              <div>
                <label for="assetReturn" class="form-label">
                  Expected Annual Return (%)
                  <span
                    class="relative group inline-block align-middle ml-1 cursor-help"
                  >
                    <span class="text-gray-400">?</span>
                    <span
                      class="hidden group-hover:block absolute z-50 mt-2 w-64 p-3 rounded-lg shadow bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm"
                    >
                      Optional. Used for future forecasts and estimated passive
                      income. Leave blank for no growth.
                    </span>
                  </span>
                </label>
                <input
                  type="number"
                  step="any"
                  id="assetReturn"
                  placeholder="e.g. 4"
                  class="input-field"
                />
              </div>

              <div>
                <label for="highGrowth" class="form-label">
                  High Growth Annual Return (%)
                  <span
                    class="relative group inline-block align-middle ml-1 cursor-help"
                  >
                    <span class="text-gray-400">?</span>
                    <span
                      class="hidden group-hover:block absolute z-50 mt-2 w-64 p-3 rounded-lg shadow bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm"
                    >
                      Optional. Used for optimistic future forecasts (higher
                      expected returns).
                    </span>
                  </span>
                </label>
                <input
                  type="number"
                  step="any"
                  id="highGrowth"
                  placeholder="e.g. 10"
                  class="input-field"
                />
              </div>
            </div>

            <div class="flex items-end md:col-span-full">
              <button type="submit" class="btn btn-block btn-green">
                Add Asset
              </button>
            </div>
          </form>

          <div class="mt-4 w-full overflow-x-auto">
            <table
              class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"
            >
              <thead
                id="assetTableHeader"
                class="bg-gray-200 dark:bg-gray-700"
              ></thead>
              <tbody
                id="assetTableBody"
                class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"
              ></tbody>
            </table>
          </div>
        </div>

        <div class="card transition">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">Liabilities & Payments</h3>
          <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
            Track debts or recurring expenses that reduce your wealth.
          </p>
          <form id="liabilityForm" class="grid grid-cols-1 md:gap-4 gap-2">
            <div class="md:col-span-full">
              <label for="liabilityName" class="form-label required-label"
                >Liability Name</label
              >
              <input
                type="text"
                id="liabilityName"
                class="input-field"
                required
              />
            </div>
            <div class="md:col-span-full">
              <label for="liabilityValue" class="form-label required-label"
                >Amount Owed (<span data-currency-symbol>£</span>)</label
              >
              <input
                type="number"
                step="any"
                id="liabilityValue"
                value="0"
                class="input-field"
                required
              />
            </div>
            <div class="md:col-span-full">
              <label for="liabilityInterest" class="form-label"
                >Annual Interest Rate (%)</label
              >
              <input
                type="number"
                step="any"
                id="liabilityInterest"
                value="0"
                class="input-field"
              />
            </div>
            <div class="md:col-span-full">
              <label for="liabilityPaymentAmount" class="form-label"
                >Recurring Payment (<span data-currency-symbol>£</span>)</label
              >
              <input
                type="number"
                step="any"
                id="liabilityPaymentAmount"
                value="0"
                class="input-field"
              />
            </div>
            <div class="md:col-span-full">
              <label for="liabilityPaymentFrequency" class="form-label"
                >Payment Frequency</label
              >
              <select id="liabilityPaymentFrequency" class="input-field">
                <option value="none">None</option>
                <option value="monthly">Monthly</option>
                <option value="quarterly">Quarterly</option>
                <option value="yearly">Yearly</option>
              </select>
            </div>
            <div class="md:col-span-full">
              <label for="liabilityStartDate" class="form-label"
                >Start Date</label
              >
              <input type="date" id="liabilityStartDate" class="input-field" />
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                Leave blank to treat this liability as active immediately.
                Balances and payments begin on the selected date.
              </p>
            </div>
            <div class="flex items-end md:col-span-full">
              <button type="submit" class="btn btn-block btn-red">
                Add Liability
              </button>
            </div>
          </form>
          <div class="mt-4 w-full overflow-x-auto">
            <table
              class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"
            >
              <thead class="bg-gray-200 dark:bg-gray-700">
                <tr>
                  <th class="table-header">Name</th>
                  <th class="table-header">Start Date</th>
                  <th class="table-header">Current (<span data-currency-symbol>£</span>)</th>
                  <th class="table-header">Payment</th>
                  <th class="table-header">
                    <span class="sr-only">Actions</span>
                  </th>
                </tr>
              </thead>
              <tbody
                id="liabilityTableBody"
                class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"
              ></tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="forecasts" class="content-section">
        <h2 class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-6">
          Forecasts
        </h2>
        <div id="forecastGoalsCard" class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">Goal Achievement</h3>
          <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
            Current totals and projected goal achievement dates based on your inputs.
          </p>
          <div class="grid grid-cols-1 gap-4">
            <div
              class="flex flex-col items-center justify-center gap-1 p-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 stat-box"
            >
              <h4 class="text-md font-medium text-gray-700 dark:text-gray-300">Total Current Wealth</h4>
              <span id="totalWealthForecast" class="text-3xl font-bold">£0</span>
            </div>
            <div id="forecastGoalsDates" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
          </div>
        </div>
        
        <div id="ForecastCard" class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">Wealth</h3>
          <p class="text-gray-700 dark:text-gray-300 text-sm">
            Click legend items to show or hide lines on the chart.
          </p>
          <div class="chart-container">
            <canvas id="wealthChart"></canvas>
            <div
              id="wealthChartMessage"
              class="text-center text-gray-500 hidden"
            >
              <p class="text-lg font-medium">Your forecast will appear here.</p>
              <p>
                Add at least one asset or liability to see your financial future projected.
                Set a wealth goal to unlock goal-focused insights.
              </p>
            </div>
          </div>
          <div
            class="mt-4 flex flex-col gap-3 text-sm text-gray-600 dark:text-gray-300 sm:flex-row sm:items-center sm:justify-between"
          >
            <p class="text-xs sm:text-sm">
              Tip: On mobile you can drag to pan, pinch to zoom, and tap an empty area to hide the
              tooltip.
            </p>
            <button
              id="wealthChartReset"
              type="button"
              class="btn btn-gray text-sm self-start sm:self-auto"
              style="padding: 0.4rem 0.75rem"
            >
              Reset view
            </button>
          </div>

        </div>

        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">One-off Events</h3>
          <p class="text-gray-700 dark:text-gray-300 text-sm">
            Model one-off future gains or losses to see their impact on your
            forecasts.
          </p>
          <p class="text-gray-700 dark:text-gray-300 text-xs mb-2">
            If no asset is linked, the event adjusts your overall portfolio
            balance.
          </p>
          <p
            id="eventsHint"
            class="text-xs text-gray-500 dark:text-gray-400 mt-1 hidden"
          >
            Events affect forecasts once you have at least one asset.
          </p>
          <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">
            Enter negative amounts or percentages (e.g., -5000 or -5) to
            simulate an unexpected loss.
          </p>
          <form
            id="eventForm"
            class="grid grid-cols-1 md:grid-cols-4 gap-2 md:gap-4"
          >
            <div>
              <label for="eventName" class="form-label">Event Name</label>
              <input type="text" id="eventName" class="input-field" required />
            </div>
            <div>
              <label for="eventAmount" class="form-label">Amount</label>
              <div class="flex gap-2">
                <input
                  type="number"
                  step="any"
                  id="eventAmount"
                  class="input-field"
                  required
                />
                <select id="eventType" class="input-field w-20">
                  <option value="absolute" data-currency-symbol>£</option>
                  <option value="percent">%</option>
                </select>
              </div>
            </div>
            <div>
              <label for="eventDate" class="form-label">Date</label>
              <input type="date" id="eventDate" class="input-field" required />
            </div>
            <div>
              <label for="eventAsset" class="form-label"
                >Linked Asset (optional)</label
              >
              <select id="eventAsset" class="input-field">
                <option value="">None</option>
              </select>
            </div>
            <div class="flex items-end md:col-span-full">
              <button
                type="submit"
                id="eventSubmitBtn"
                class="btn btn-block btn-green"
              >
                Add Event
              </button>
            </div>
          </form>
          <div class="mt-4 overflow-x-auto">
            <table
              class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"
            >
              <thead class="bg-gray-200 dark:bg-gray-700">
                <tr>
                  <th class="table-header">Event</th>
                  <th class="table-header">Date</th>
                  <th class="table-header">Asset</th>
                  <th class="table-header">Amount</th>
                  <th class="table-header">Actions</th>
                </tr>
              </thead>
              <tbody
                id="eventTableBody"
                class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"
              ></tbody>
            </table>
          </div>
        </div>

        <div id="progressCheckCard" class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">Progress Check</h3>
          <p class="text-sm text-gray-600 dark:text-gray-300">
            Compare your current position with the forecast that was saved when
            you took a snapshot.
          </p>
          <div
            id="progressCheckEmpty"
            class="mt-4 text-sm text-gray-500 dark:text-gray-400"
          >
            Take a snapshot to unlock progress comparisons.
          </div>
          <div
            id="progressCheckControls"
            class="mt-4 space-y-4 hidden"
          >
            <div>
              <label for="progressCheckSelect" class="form-label"
                >Compare against snapshot</label
              >
              <select
                id="progressCheckSelect"
                class="input-field"
              ></select>
            </div>
            <div
              id="progressCheckResult"
              class="rounded-xl border border-gray-200 bg-gray-50 p-4 text-sm text-gray-700 dark:border-gray-700 dark:bg-gray-700/50 dark:text-gray-200"
            >
              Select a snapshot to see how you're tracking against its saved
              forecast.
            </div>
          </div>
        </div>
        <div id="StressTestCard" class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">Stress Testing (Monte Carlo Simulations)</h3>
          <p class="text-gray-700 dark:text-gray-300 text-sm">
            Run Monte Carlo simulations with random market events (±15%) to see
            how they affect your goal timeline.
          </p>
          <form
            id="stressTestForm"
            class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end mt-2"
          >
            <div>
              <label for="stressRuns" class="form-label">Simulations</label>
              <input
                type="number"
                id="stressRuns"
                class="input-field"
                value="100"
                min="1"
                max="1000"
                />
            </div>
            <div>
              <label for="stressScenario" class="form-label"
                >Scenario Baseline</label
              >
              <select id="stressScenario" class="input-field">
                <option value="low">Low Growth</option>
                <option value="base" selected>Expected Growth</option>
                <option value="high">High Growth</option>
              </select>
            </div>
            <div>
              <label for="stressAssetsToggle" class="form-label">Assets</label>
              <div class="relative">
                <button
                  type="button"
                  id="stressAssetsToggle"
                  class="input-field text-left"
                >
                  All Assets
                </button>
                <div
                  id="stressAssetsMenu"
                  class="hidden absolute z-10 w-full bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg mt-1 max-h-40 overflow-y-auto"
                ></div>
              </div>
            </div>
            <div class="flex md:col-span-full">
              <button type="submit" class="btn btn-block btn-green md:mb-1">
                Run Stress Test
              </button>
            </div>
          </form>
          <div id="stressTestResult" class="mt-4 text-sm"></div>
        </div>
      </div>

      <div id="portfolio-analysis" class="content-section">
        <h2 class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-6">
          Portfolio Insights
        </h2>

        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">
            Total Current Wealth
          </h3>
          <div
            class="flex flex-col items-center justify-center gap-1 p-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-center text-gray-900 dark:text-gray-100 stat-box w-full"
          >
            <h4 class="text-md font-medium text-gray-700 dark:text-gray-300">
              Current Total
            </h4>
            <span id="totalWealth" class="text-3xl font-bold">£0</span>
          </div>
        </div>

        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">Portfolio Allocation</h3>
          <div class="chart-container">
            <canvas id="assetBreakdownChart"></canvas>
            <div id="noAssetMessage" class="text-center text-gray-500">
              <p>
                No assets added. Add an asset on the Assets & Goals page to see
                your breakdown.
              </p>
            </div>
          </div>
        </div>

        <div id="futureValueCard" class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">Future Asset Value</h3>
          <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
            Project an asset's potential value on a future date using your
            growth projections.
          </p>
          <form
            id="futureValueForm"
            class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end"
          >
            <div>
              <label for="fvAsset" class="form-label required-label"
                >Asset</label
              >
              <select id="fvAsset" class="input-field" required></select>
            </div>
            <div>
              <label for="fvDate" class="form-label required-label"
                >Future Date</label
              >
              <input type="date" id="fvDate" class="input-field" required />
            </div>
            <div class="flex md:col-span-full">
              <button type="submit" class="btn btn-block btn-green md:mb-1">
                Check Future Value
              </button>
            </div>
          </form>
          <div
            id="fvResult"
            class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-4 hidden"
          >
            <div
              class="flex flex-col items-center justify-center gap-1 p-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 stat-box"
            >
              <h4 class="text-md font-medium text-gray-700 dark:text-gray-300">Low</h4>
              <span id="fvLow" class="text-3xl font-bold">£0</span>
            </div>
            <div
              class="flex flex-col items-center justify-center gap-1 p-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 stat-box"
            >
              <h4 class="text-md font-medium text-gray-700 dark:text-gray-300">Expected</h4>
              <span id="fvExpected" class="text-3xl font-bold">£0</span>
            </div>
            <div
              class="flex flex-col items-center justify-center gap-1 p-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 stat-box"
            >
              <h4 class="text-md font-medium text-gray-700 dark:text-gray-300">High</h4>
              <span id="fvHigh" class="text-3xl font-bold">£0</span>
            </div>
          </div>
        </div>

        <div class="card" id="passiveIncomeCard">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">Estimated Passive Income</h3>
          <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
            Based on expected annual returns after tax and current values. Update your tax
            settings to change these net figures.
          </p>
          <div class="mb-4">
            <label for="passiveIncomeDate" class="form-label"
              >Estimate as of (optional)</label
            >
            <input type="date" id="passiveIncomeDate" class="input-field" />
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
              Defaults to today. Future dates apply scheduled one-off events.
            </p>
          </div>
          <div class="mb-4">
            <label for="passiveAssetToggle" class="form-label"
              >Assets included</label
            >
            <div id="passiveAssetPicker" class="relative">
              <button
                type="button"
                id="passiveAssetToggle"
                class="input-field flex items-center justify-between"
                aria-haspopup="listbox"
                aria-expanded="false"
                disabled
              >
                <span id="passiveAssetSummary"
                  >All passive assets selected</span
                >
                <i class="fa-solid fa-chevron-down text-gray-400 ml-2"></i>
              </button>
              <div
                id="passiveAssetMenu"
                class="absolute z-20 mt-1 w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg hidden"
              >
                <div
                  class="flex items-center justify-between px-3 py-2 border-b border-gray-200 dark:border-gray-700"
                >
                  <button
                    type="button"
                    id="passiveAssetSelectAll"
                    class="text-xs font-medium text-purple-600 dark:text-purple-300 hover:underline disabled:opacity-50"
                  >
                    Select all
                  </button>
                  <button
                    type="button"
                    id="passiveAssetClear"
                    class="text-xs text-gray-500 dark:text-gray-400 hover:underline disabled:opacity-50"
                  >
                    Clear
                  </button>
                </div>
                <div id="passiveAssetOptions" class="max-h-48 overflow-y-auto"></div>
              </div>
            </div>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
              Choose which passive income assets to include in this estimate.
            </p>
            <p
              id="passiveAssetSelectionMessage"
              class="text-xs text-amber-600 dark:text-amber-400 mt-2 hidden"
            >
              Select at least one asset to see a passive income estimate.
            </p>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div
              class="flex flex-col items-center justify-center gap-1 p-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 stat-box"
            >
              <h4 class="text-md font-medium text-gray-700 dark:text-gray-300">Daily</h4>
              <span id="passiveDaily" class="text-3xl font-bold">£0</span>
            </div>
            <div
              class="flex flex-col items-center justify-center gap-1 p-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 stat-box"
            >
              <h4 class="text-md font-medium text-gray-700 dark:text-gray-300">Weekly</h4>
              <span id="passiveWeekly" class="text-3xl font-bold"
                >£0</span
              >
            </div>
            <div
              class="flex flex-col items-center justify-center gap-1 p-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 stat-box"
            >
              <h4 class="text-md font-medium text-gray-700 dark:text-gray-300">Monthly</h4>
              <span id="passiveMonthly" class="text-3xl font-bold"
                >£0</span
              >
            </div>
          </div>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-3">
            Excludes new contributions; shows growth from appreciation only,
            using your selected date when provided.
          </p>
        </div>

        <div class="card" id="fireForecastCard">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">FIRE Readiness (Passive Income Forecast)</h3>
          <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
            Project when the assets you have marked as providing passive income
            could cover your living costs under each growth scenario. The
            projection compounds each asset using its low, expected, and high
            returns, estimates the annual passive income, and compares it to
            your costs with and without inflation.
          </p>
          <div class="bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 text-blue-900 dark:text-blue-100 text-xs rounded-lg p-3 mb-4">
            Mark at least one asset as “Passive Income” for this card to use its
            forecasts. Living costs should be entered in today's money. We adjust
            them for inflation and optionally begin checking from your intended
            retirement date.
          </div>
          <form id="fireForecastForm" class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
            <div>
              <label for="fireForecastLivingCosts" class="form-label required-label"
                >Living Costs (<span data-currency-symbol>£</span>)</label
              >
              <input
                type="number"
                step="any"
                id="fireForecastLivingCosts"
                class="input-field"
                required
              />
            </div>
            <div>
              <label for="fireForecastFrequency" class="form-label"
                >Frequency</label
              >
              <select id="fireForecastFrequency" class="input-field">
                <option value="annual">Annual</option>
                <option value="monthly">Monthly</option>
              </select>
            </div>
            <div>
              <label for="fireForecastInflation" class="form-label"
                >Expected Inflation (% per year)</label
              >
              <input
                type="number"
                step="any"
                id="fireForecastInflation"
                class="input-field"
              />
            </div>
            <div>
              <label for="fireForecastRetireDate" class="form-label"
                >Retirement Start Date (optional)</label
              >
              <input
                type="date"
                id="fireForecastRetireDate"
                class="input-field"
              />
            </div>
            <div class="md:col-span-2">
              <button type="submit" class="btn btn-green btn-block">
                Update FIRE Forecast
              </button>
            </div>
          </form>
          <div
            id="fireForecastSummary"
            class="text-sm text-gray-700 dark:text-gray-300 mt-4"
          ></div>
          <div
            id="fireForecastResults"
            class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mt-4"
          ></div>
        </div>

        <div id="inflationImpactCard" class="card is-collapsible" style="display:none;">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">Inflation Impact</h3>
          <div class="card-body">
          <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
            Enter an annual inflation rate to see the value of your goal in today's money at the point it's reached for each scenario.
          </p>
            <form id="inflationForm" class="grid grid-cols-1 md:grid-cols-4 gap-2 md:gap-4 items-end relative z-0">
            <div>
              <label for="inflationRate" class="form-label">Annual Inflation (%)</label>
              <input type="number" step="any" id="inflationRate" class="input-field" value="2.5" />
            </div>
            <div class="flex md:col-span-full">
              <button type="submit" class="btn btn-green btn-block w-full">Update</button>
            </div>
          </form>
            <div id="inflationResult" class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mt-4 relative z-10">
              <div class="p-3 rounded-lg bg-gray-100 dark:bg-gray-700 text-center stat-box relative z-0 hover:z-50">
                <h5 class="font-bold text-gray-900 dark:text-gray-100 flex items-center justify-center gap-1">
                  Low Growth
                  <span class="relative group inline-block align-middle cursor-help">
                    <span class="text-gray-400">?</span>
                    <span class="hidden group-hover:block absolute z-50 mt-2 w-64 p-3 rounded-lg shadow bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-xs">Present value of your goal at the low-growth goal date, using the inflation rate above.</span>
                  </span>
              </h5>
                <p id="inflLow" class="mt-1"></p>
                <p id="inflLowYear" class="text-xs text-gray-500 dark:text-gray-400"></p>
                <p id="inflLowEq" class="text-xs text-gray-500 dark:text-gray-400"></p>
              </div>
              <div class="p-3 rounded-lg bg-gray-100 dark:bg-gray-700 text-center stat-box relative z-0 hover:z-50">
                <h5 class="font-bold text-gray-900 dark:text-gray-100 flex items-center justify-center gap-1">
                  Expected Growth
                  <span class="relative group inline-block align-middle cursor-help">
                    <span class="text-gray-400">?</span>
                    <span class="hidden group-hover:block absolute z-50 mt-2 w-64 p-3 rounded-lg shadow bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-xs">Present value of your goal at the expected-growth goal date, using the inflation rate above.</span>
                  </span>
              </h5>
                <p id="inflExpected" class="mt-1"></p>
                <p id="inflExpectedYear" class="text-xs text-gray-500 dark:text-gray-400"></p>
                <p id="inflExpectedEq" class="text-xs text-gray-500 dark:text-gray-400"></p>
              </div>
              <div class="p-3 rounded-lg bg-gray-100 dark:bg-gray-700 text-center stat-box relative z-0 hover:z-50">
                <h5 class="font-bold text-gray-900 dark:text-gray-100 flex items-center justify-center gap-1">
                  High Growth
                  <span class="relative group inline-block align-middle cursor-help">
                    <span class="text-gray-400">?</span>
                    <span class="hidden group-hover:block absolute z-50 mt-2 w-64 p-3 rounded-lg shadow bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-xs">Present value of your goal at the high-growth goal date, using the inflation rate above.</span>
                  </span>
              </h5>
                <p id="inflHigh" class="mt-1"></p>
                <p id="inflHighYear" class="text-xs text-gray-500 dark:text-gray-400"></p>
                <p id="inflHighEq" class="text-xs text-gray-500 dark:text-gray-400"></p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="snapshots" class="content-section">
        <h2 class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-6">
          Snapshots
        </h2>
        <div id="saveSnapshotCard" class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">Save Snapshot</h3>
          <p class="text-gray-700 dark:text-gray-300 text-sm mb-1">
            Save your current totals to track progress over time.
          </p>
          <p
            id="snapshotEmptyHint"
            class="text-xs text-gray-500 dark:text-gray-400 mb-4 hidden"
          >
            Add at least one asset before saving a snapshot.
          </p>
          <div class="flex flex-col gap-4">
            <div>
              <label for="snapshotName" class="form-label required-label"
                >Snapshot Name</label
              >
              <input
                type="text"
                id="snapshotName"
                placeholder="e.g. End of Q2"
                class="input-field"
                required
              />
            </div>
            <button
              id="snapshotBtn"
              data-action="take-snapshot"
              class="btn btn-block btn-green"
            >
              Take Snapshot
            </button>
          </div>
          <div id="snapshotList" class="mt-4">
            <h4
              id="snapshotsHeader"
              class="text-md font-medium text-gray-700 dark:text-gray-300 mb-2"
            >Saved Snapshots:</h4>
            <ul
              id="snapshotUl"
              class="divide-y divide-gray-200 dark:divide-gray-700"
            ></ul>
          </div>
        </div>
        <div id="snapshotHistoryCard" class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">Snapshot History</h3>
          <div class="chart-container">
            <canvas id="snapshotChart"></canvas>
            <div
              id="noSnapshotMessage"
              class="text-center text-gray-500 hidden"
            >
              <p>
                No snapshots taken yet. Take a snapshot to track your wealth
                over time.
              </p>
            </div>
          </div>
        </div>
      </div>

      <div id="calculators" class="content-section">
        <h2 class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-6">
          Calculators
        </h2>
        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
            Share Target Profit (%)
          </h3>
          <div class="card-body">
            <form
              id="stockProfitForm"
              class="grid grid-cols-1 md:grid-cols-2 gap-4"
            >
              <div>
                <label for="stock-price" class="form-label required-label"
                  >Price (pence)</label
                >
                <input
                  type="number"
                  step="any"
                  id="stock-price"
                  class="input-field"
                  required
                />
              </div>
              <div>
                <label for="sdrt-tax" class="form-label">
                  Tax on purchase (%)
                  <span
                    class="relative group inline-block align-middle ml-1 cursor-help"
                  >
                    <span class="text-gray-400">?</span>
                    <span
                      class="hidden group-hover:block absolute z-50 mt-2 w-64 p-3 rounded-lg shadow bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm"
                    >
                      Default 0.5%, the standard UK SDRT rate.
                    </span>
                  </span>
                </label>
                <input
                  type="number"
                  step="any"
                  id="sdrt-tax"
                  value="0.5"
                  class="input-field"
                />
              </div>
              <div>
                <label for="target-return" class="form-label required-label"
                  >Target % Return</label
                >
                <input
                  type="number"
                  step="any"
                  id="target-return"
                  class="input-field"
                  required
                />
              </div>
              <div class="md:col-span-2 flex items-end">
                <button type="submit" class="btn btn-block btn-green">
                  Calculate
                </button>
              </div>
            </form>
            <div id="stockProfitResult" class="mt-4 text-center"></div>
          </div>
        </div>

        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
            Share Target Profit (<span data-currency-symbol>£</span>)
          </h3>
          <div class="card-body">
            <form
              id="stockProfitAmountForm"
              class="grid grid-cols-1 md:grid-cols-2 gap-4"
            >
              <div>
                <label
                  for="stock-price-profit"
                  class="form-label required-label"
                  >Price (pence)</label
                >
                <input
                  type="number"
                  step="any"
                  id="stock-price-profit"
                  class="input-field"
                  required
                />
              </div>
              <div>
                <label for="sdrt-tax-profit" class="form-label">
                  Tax on purchase (%)
                  <span
                    class="relative group inline-block align-middle ml-1 cursor-help"
                  >
                    <span class="text-gray-400">?</span>
                    <span
                      class="hidden group-hover:block absolute z-50 mt-2 w-64 p-3 rounded-lg shadow bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm"
                    >
                      Default 0.5%, the standard UK SDRT rate.
                    </span>
                  </span>
                </label>
                <input
                  type="number"
                  step="any"
                  id="sdrt-tax-profit"
                  value="0.5"
                  class="input-field"
                />
              </div>
              <div>
                <label
                  for="stock-shares-profit"
                  class="form-label required-label"
                  >Number of Shares</label
                >
                <input
                  type="number"
                  step="any"
                  id="stock-shares-profit"
                  class="input-field"
                  required
                />
              </div>
              <div>
                <label for="target-profit" class="form-label required-label"
                  >Target Profit (<span data-currency-symbol>£</span>)</label
                >
                <input
                  type="number"
                  step="any"
                  id="target-profit"
                  class="input-field"
                  required
                />
              </div>
              <div class="md:col-span-2 flex items-end">
                <button type="submit" class="btn btn-block btn-green">
                  Calculate
                </button>
              </div>
            </form>
            <div id="stockProfitAmountResult" class="mt-4 text-center"></div>
          </div>
        </div>

        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
            Compound Interest Calculator
          </h3>
          <div class="card-body">
            <form
              id="compoundForm"
              class="grid grid-cols-1 md:grid-cols-2 gap-4"
            >
              <div>
                <label for="ci-principal" class="form-label required-label"
                  >Principal (<span data-currency-symbol>£</span>)</label
                >
                <input
                  type="number"
                  step="any"
                  id="ci-principal"
                  class="input-field"
                  required
                />
              </div>
              <div>
                <label for="ci-rate" class="form-label required-label"
                  >Annual Rate (%)</label
                >
                <input
                  type="number"
                  step="any"
                  id="ci-rate"
                  class="input-field"
                  required
                />
              </div>
              <div>
                <label for="ci-years" class="form-label required-label"
                  >Years</label
                >
                <input
                  type="number"
                  step="any"
                  id="ci-years"
                  class="input-field"
                  required
                />
              </div>
              <div>
                <label for="ci-frequency" class="form-label"
                  >Compounding Interval</label
                >
                <select id="ci-frequency" class="input-field">
                  <option value="monthly" selected>Monthly</option>
                  <option value="yearly">Yearly</option>
                  <option value="weekly">Weekly</option>
                  <option value="daily">Daily</option>
                </select>
              </div>
              <div>
                <label for="ci-contribution" class="form-label"
                  >Monthly Contribution (<span data-currency-symbol>£</span>)</label
                >
                <input
                  type="number"
                  step="any"
                  id="ci-contribution"
                  value="0"
                  class="input-field"
                />
              </div>
              <div class="md:col-span-2 flex items-end">
                <button type="submit" class="btn btn-block btn-green">
                  Calculate
                </button>
              </div>
            </form>
            <div id="compoundResult" class="mt-4"></div>
          </div>
        </div>

        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
            Simple Interest Calculator
          </h3>
          <div class="card-body">
            <form
              id="simpleInterestForm"
              class="grid grid-cols-1 md:grid-cols-2 gap-4"
            >
              <div>
                <label for="si-principal" class="form-label required-label"
                  >Principal (<span data-currency-symbol>£</span>)</label
                >
                <input
                  type="number"
                  step="any"
                  id="si-principal"
                  class="input-field"
                  required
                />
              </div>
              <div>
                <label for="si-rate" class="form-label required-label"
                  >Annual Rate (%)</label
                >
                <input
                  type="number"
                  step="any"
                  id="si-rate"
                  class="input-field"
                  required
                />
              </div>
              <div>
                <label for="si-years" class="form-label required-label"
                  >Years</label
                >
                <input
                  type="number"
                  step="any"
                  id="si-years"
                  class="input-field"
                  required
                />
              </div>
              <div class="md:col-span-2 flex items-end">
                <button type="submit" class="btn btn-block btn-green">
                  Calculate
                </button>
              </div>
            </form>
            <div id="simpleInterestResult" class="mt-4"></div>
          </div>
        </div>

        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
            UK Tax Impact Estimator
          </h3>
          <div class="card-body">
            <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">
              Estimate the annual tax due on an asset using your tax settings. Select an existing
              asset to use its current value and growth assumptions, or keep manual entry to model a
              what-if scenario.
            </p>
            <form id="taxImpactForm" class="grid grid-cols-1 md:grid-cols-2 gap-2 md:gap-4">
              <div class="md:col-span-2">
                <label for="taxAssetSelect" class="form-label">Asset</label>
                <select id="taxAssetSelect" class="input-field">
                  <option value="">Manual entry</option>
                </select>
                <p id="taxCalculatorSourceNotice" class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                  Manual scenario. The allowances above are applied entirely to this asset.
                </p>
              </div>
              <div>
                <label for="taxAssetValue" class="form-label">
                  Asset value (<span data-currency-symbol>£</span>)
                </label>
                <input
                  type="number"
                  step="any"
                  id="taxAssetValue"
                  class="input-field"
                  placeholder="e.g. 10000"
                />
              </div>
              <div>
                <label for="taxAssetReturn" class="form-label">
                  Expected annual return (%)
                </label>
                <input
                  type="number"
                  step="any"
                  id="taxAssetReturn"
                  class="input-field"
                  placeholder="e.g. 4"
                />
              </div>
              <div>
                <label for="taxAssetTreatment" class="form-label">Tax treatment</label>
                <select id="taxAssetTreatment" class="input-field">
                  <option value="income">Taxed as income (interest, rent, bond coupons)</option>
                  <option value="dividend">Taxed as dividends</option>
                  <option value="capital-gains">Capital gains tax on sale</option>
                  <option value="tax-free">Tax-free or sheltered (ISA, pension)</option>
                </select>
              </div>
              <div>
                <label for="taxScenario" class="form-label">Scenario</label>
                <select id="taxScenario" class="input-field">
                  <option value="base">Expected growth</option>
                  <option value="low">Low growth</option>
                  <option value="high">High growth</option>
                </select>
              </div>
              <div class="md:col-span-2 flex items-end">
                <button type="submit" class="btn btn-block btn-green">Estimate tax</button>
              </div>
            </form>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
              Results are annual and use the allowances set above. Tax estimates are illustrative and assume UK rules.
            </p>
            <div id="taxCalculatorResult" class="mt-4"></div>
          </div>
        </div>

        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
            FIRE (Simple)
          </h3>
          <div class="card-body">
            <div class="mb-4 p-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 stat-box">
              <h4 class="font-semibold mb-2">How this works</h4>
              <p class="text-sm mb-2">
                Your FIRE (Financial Independence, Retire Early) number is the lump sum you need so your investments can pay for
                your living costs throughout retirement.
              </p>
              <p class="text-sm mb-2">This simple version uses:</p>
              <ul class="list-disc ml-5 text-sm">
                <li><strong>Your yearly living costs</strong> - what you expect to spend each year.</li>
                <li><strong>Safe Withdrawal Rate (SWR)</strong> - the % you feel comfortable taking from your pot each year (4% is a common rule-of-thumb).</li>
              </ul>
              <p class="text-sm mt-2">
                Your FIRE number is just your yearly costs divided by your SWR. Example: £25,000 a year and a 4% SWR would be calculated as £25,000 / 0.04 = £625,000.
                The progress bar compares this target with your current net worth.
              </p>
            </div>
            <form id="fireForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="md:col-span-2">
                <label for="fireLivingExpenses" class="form-label required-label"
                  >Living Costs (<span data-currency-symbol>£</span>)</label
                >
                <div class="flex flex-col gap-2 sm:flex-row sm:items-center">
                  <input
                    type="number"
                    step="any"
                    min="0"
                    id="fireLivingExpenses"
                    class="input-field sm:flex-1"
                    required
                  />
                  <select
                    id="fireExpensesFrequency"
                    class="input-field sm:w-48"
                  >
                    <option value="annual">Per year</option>
                    <option value="monthly">Per month</option>
                  </select>
                </div>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
                  We'll convert monthly spending into an annual figure for the
                  calculation.
                </p>
              </div>
              <div>
                <label for="fireWithdrawalRate" class="form-label required-label"
                  >Safe Withdrawal Rate (%)</label
                >
                <input
                  type="number"
                  step="0.1"
                  min="0.1"
                  id="fireWithdrawalRate"
                  class="input-field"
                  required
                />
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
                  Classic rule-of-thumb is 4%. Adjust to your preference.
                </p>
              </div>
              <div class="md:col-span-2 flex items-end">
                <button type="submit" class="btn btn-block btn-green">
                  Calculate
                </button>
              </div>
            </form>
            <div
              id="fireResult"
              class="mt-4 text-sm text-gray-700 dark:text-gray-300"
            >
              Enter your living costs to see your FIRE target.
            </div>
          </div>
        </div>
      </div>

      <!-- One modal shell + templates -->
        <div id="modal" class="modal modal-hidden modal-overlay">
          <div
            class="modal-panel max-w-xl sm:max-w-2xl w-full relative"
          >
            <button
              class="modal-close absolute top-3 right-3 btn-icon"
              data-action="close-modal"
            >
              ×
            </button>
            <div id="modal-body" class="overflow-y-auto max-h-[80vh]"></div>
          </div>
        </div>

      <div id="settings" class="content-section">
        <h2
          class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-6 text-left"
        >
          Settings & Data
        </h2>
        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Profiles</h3>
          <div class="card-body">
            <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
              Create and switch between profiles to keep scenarios separate.
              Assets, events, snapshots, and goals are saved per profile.
            </p>
            <div class="grid grid-cols-1 sm:grid-cols-4 gap-2 sm:gap-4 items-end">
              <div class="sm:col-span-3">
                <label for="profileSelect" class="form-label">Profile</label>
                <div class="flex items-center gap-2">
                  <select id="profileSelect" class="input-field flex-1"></select>
                  <div class="hidden sm:flex gap-2">
                    <button
                      id="addProfileBtn"
                      class="btn-icon"
                      title="Add Profile"
                    >
                      <i class="fa-solid fa-plus"></i>
                    </button>
                    <button
                      id="renameProfileBtn"
                      class="btn-icon"
                      title="Rename Profile"
                    >
                      <i class="fa-solid fa-pen"></i>
                    </button>
                    <button
                      id="deleteProfileBtn"
                      class="btn-icon"
                      title="Delete Profile"
                    >
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  </div>
                </div>
                <div class="mt-2 flex flex-col gap-2 sm:hidden">
                  <button id="addProfileBtnMobile" class="btn btn-green w-full">
                    <i class="fa-solid fa-plus mr-2"></i>Add Profile
                  </button>
                  <button id="renameProfileBtnMobile" class="btn btn-gray w-full">
                    <i class="fa-solid fa-pen mr-2"></i>Rename Profile
                  </button>
                  <button id="deleteProfileBtnMobile" class="btn btn-red w-full">
                    <i class="fa-solid fa-trash mr-2"></i>Delete Profile
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
            Theme
          </h3>
          <div class="card-body">
            <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
              Choose a look and feel. Your choice is saved for next time.
            </p>
            <div class="max-w-xs">
              <label for="themeSelect" class="form-label">Theme</label>
              <select id="themeSelect" class="input-field">
                <option value="default">Default</option>
                <option value="inverted">Inverted</option>
                <option value="glass">Glass</option>
              </select>
            </div>
          </div>
        </div>

        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
            UK Tax Settings
          </h3>
          <div class="card-body">
            <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
              Choose your UK tax band and adjust annual allowances. Forecasts and passive income
              use these values to model net, after-tax growth for taxable assets.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-2 md:gap-4">
              <div>
                <label for="taxBandSelect" class="form-label">Tax band</label>
                <select id="taxBandSelect" class="input-field">
                  <option value="basic">Basic rate (20%)</option>
                  <option value="higher">Higher rate (40%)</option>
                  <option value="additional">Additional rate (45%)</option>
                </select>
              </div>
              <div>
                <label for="taxIncomeAllowance" class="form-label">
                  Savings allowance (<span data-currency-symbol>£</span>)
                </label>
                <input
                  type="number"
                  step="any"
                  id="taxIncomeAllowance"
                  class="input-field"
                />
              </div>
              <div>
                <label for="taxDividendAllowance" class="form-label">
                  Dividend allowance (<span data-currency-symbol>£</span>)
                </label>
                <input
                  type="number"
                  step="any"
                  id="taxDividendAllowance"
                  class="input-field"
                />
              </div>
              <div>
                <label for="taxCapitalAllowance" class="form-label">
                  Capital gains allowance (<span data-currency-symbol>£</span>)
                </label>
                <input
                  type="number"
                  step="any"
                  id="taxCapitalAllowance"
                  class="input-field"
                />
              </div>
            </div>
            <p id="taxBandSummary" class="text-sm text-gray-600 dark:text-gray-300 mt-3"></p>
            <p id="taxAllowanceSummary" class="text-xs text-gray-500 dark:text-gray-400 mt-1"></p>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
              Allowances apply per tax year across all assets marked as taxable. Changes update forecasts automatically.
            </p>
          </div>
        </div>

        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">Currency</h3>
          <div class="card-body">
            <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
              Choose the currency used throughout the app. Labels and values
              will update immediately.
            </p>
            <div class="max-w-xs">
              <label for="currencySelect" class="form-label">Currency</label>
              <select id="currencySelect" class="input-field">
                <option value="GBP">Pounds (£)</option>
                <option value="USD">Dollars ($)</option>
                <option value="EUR">Euros (€)</option>
              </select>
            </div>
          </div>
        </div>

        <div id="welcomeCard" class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">
            First-Time Use Content
          </h3>
          <div class="card-body">
            <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
              Choose whether to hide the welcome page and other first-time guidance once
              you know your way around.
            </p>
            <label class="dark-mode-toggle">
              <span class="mr-3 font-semibold text-gray-500 dark:text-gray-400"
                >Hide first-time use content</span
              >
              <input type="checkbox" id="welcomeToggle" class="peer" />
              <span class="toggle-track"><span class="toggle-thumb"></span></span>
            </label>
          </div>
        </div>

        <div id="exportCard" class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
            Export Data
          </h3>
          <div class="card-body flex flex-col">
            <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
              Export data with an optional password for backup or use on
              another device.
            </p>
            <div>
              <label for="exportPassword" class="form-label"
                >Password (Optional)</label
              >
              <input
                type="password"
                id="exportPassword"
                placeholder="Enter a password to encrypt"
                class="input-field"
              />
            </div>
            <div class="mt-4">
              <label class="form-label" for="exportProfileToggle"
                >Profiles to Export</label
              >
              <div id="exportProfilePicker" class="relative">
                <button
                  type="button"
                  id="exportProfileToggle"
                  class="input-field flex items-center justify-between"
                  aria-haspopup="listbox"
                  aria-expanded="false"
                >
                  <span id="exportProfileSummary">All profiles selected</span>
                  <i class="fa-solid fa-chevron-down text-gray-400 ml-2"></i>
                </button>
                <div
                  id="exportProfileMenu"
                  class="absolute z-20 mt-1 w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg max-h-48 overflow-y-auto hidden"
                >
                  <div id="exportProfileOptions"></div>
                </div>
              </div>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
                All profiles are selected by default. Deselect any you don't
                want to include.
              </p>
            </div>
            <div class="mt-4">
              <button
                id="exportBtn"
                data-action="export-data"
                class="btn btn-block btn-purple flex items-center justify-center"
              >
                <svg
                  class="h-5 w-5 mr-2"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" />
                </svg>
                Export Data
              </button>
              <p
                id="exportEmptyHint"
                class="text-xs text-gray-500 dark:text-gray-400 mt-2 hidden"
              >
                No data to export yet. Add assets, liabilities, events, or
                snapshots first.
              </p>
            </div>
          </div>
        </div>


        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
            Import Data
          </h3>
          <div class="card-body flex flex-col">
            <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
              Import previously saved data to restore your information.
            </p>
            <div>
              <label for="importFile" class="form-label">Select File</label>
              <label
                for="importFile"
                class="flex items-center justify-center w-full px-3 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600"
              >
                <svg
                  class="h-5 w-5 mr-2 text-gray-500"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zM6 20V4h7v5h5v11H6z"
                  />
                </svg>
                <span
                  class="text-gray-900 dark:text-gray-100"
                  data-import-filename
                  >No file chosen</span
                >
                <input
                  type="file"
                  id="importFile"
                  accept=".json"
                  class="hidden"
                />
              </label>
            </div>
            <div class="mt-4">
              <label for="importPassword" class="form-label"
                >Password (Optional)</label
              >
              <input
                type="password"
                id="importPassword"
                placeholder="Enter password for file"
                class="input-field"
              />
            </div>
            <div class="mt-4">
              <label class="form-label" for="importProfileToggle"
                >Profiles to Import</label
              >
              <div id="importProfilePicker" class="relative">
                <button
                  type="button"
                  id="importProfileToggle"
                  class="input-field flex items-center justify-between"
                  aria-haspopup="listbox"
                  aria-expanded="false"
                  disabled
                >
                  <span id="importProfileSummary"
                    >Select a file to choose profiles</span
                  >
                  <i class="fa-solid fa-chevron-down text-gray-400 ml-2"></i>
                </button>
                <div
                  id="importProfileMenu"
                  class="absolute z-20 mt-1 w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg max-h-48 overflow-y-auto hidden"
                >
                  <div id="importProfileOptions"></div>
                </div>
              </div>
              <p
                id="importProfileHint"
                class="text-xs text-gray-500 dark:text-gray-400 mt-2"
              >
                Profiles from the selected file will appear here once the
                password (if any) is provided.
              </p>
            </div>
            <div class="mt-4">
              <button
                data-action="import-data"
                class="btn btn-block btn-blue flex items-center justify-center"
              >
                <svg
                  class="h-5 w-5 mr-2"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M19 15h-4v4h-2v-4h-4v-2h4v-4h2v4h4v2zM5 19V5h14v8h2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2h8v-2H5z"
                  />
                </svg>
                Import Data
              </button>
            </div>
          </div>
        </div>

        <div class="card">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">Reset App</h3>
          <div class="card-body">
            <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
              Clear all locally stored data and restart the app.
            </p>
            <button class="btn btn-red flex items-center" data-action="clear-data">
              <i class="fa-solid fa-trash mr-2"></i>
              Clear Data
            </button>
          </div>
        </div>
      </div>
    </main>

    <template id="tpl-alert">
      <div class="text-center">
        <div class="mb-6" data-text></div>
        <div class="flex justify-center">
          <button class="btn btn-green" data-ok>OK</button>
        </div>
      </div>
    </template>

    <template id="tpl-confirm">
      <div class="text-center">
        <div class="mb-6" data-text></div>
        <div class="flex justify-center gap-4">
          <button class="btn btn-red" data-confirm>Confirm</button>
          <button class="btn btn-gray" data-cancel>Cancel</button>
        </div>
      </div>
    </template>

    <template id="tpl-prompt">
      <div class="text-center">
        <div class="mb-4" data-text></div>
        <input type="text" class="input-field mb-6" data-input />
        <div class="flex justify-center gap-4">
          <button class="btn btn-green" data-ok>OK</button>
          <button class="btn btn-gray" data-cancel>Cancel</button>
        </div>
      </div>
    </template>

    <template id="tpl-snapshot-details">
      <div>
        <h4 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-2">Snapshot Details</h4>
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-4" data-date></p>
        <div class="overflow-y-auto max-h-96" data-list></div>
        <div class="mt-4 text-center">
          <button class="btn btn-blue" data-close>Close</button>
        </div>
      </div>
    </template>

    <template id="tpl-edit-asset">
      <div>
        <h4 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-4">Edit Asset</h4>
        <form
          id="editAssetFormModal"
          class="grid grid-cols-1 sm:grid-cols-2 gap-4"
        >
          <input type="hidden" id="editAssetIndex" />
          <div class="sm:col-span-2">
            <label for="editAssetName" class="form-label required-label"
              >Asset Name</label
            >
            <input
              type="text"
              id="editAssetName"
              class="input-field"
              required
            />
          </div>
          <div>
            <label for="editAssetValue" class="form-label required-label"
              >Initial Value (<span data-currency-symbol>£</span>)</label
            >
            <input
              type="number"
              step="any"
              id="editAssetValue"
              class="input-field"
              required
            />
          </div>
          <div>
            <label for="editDepositAmount" class="form-label"
              >Deposit Amount (<span data-currency-symbol>£</span>)</label
            >
            <input
              type="number"
              step="any"
              id="editDepositAmount"
              class="input-field"
            />
          </div>
          <div class="sm:col-span-2">
            <label for="editDepositFrequency" class="form-label"
              >Deposit Frequency</label
            >
            <select id="editDepositFrequency" class="input-field">
              <option value="none">None</option>
              <option value="monthly">Monthly</option>
              <option value="quarterly">Quarterly</option>
              <option value="yearly">Yearly</option>
            </select>
          </div>
          <div class="sm:col-span-2">
            <label for="editAssetStartDate" class="form-label">Start Date</label>
            <input type="date" id="editAssetStartDate" class="input-field" />
          </div>
          <div class="sm:col-span-2">
            <label class="form-label"
              >Include in estimated Passive Income values</label
            >
            <label class="dark-mode-toggle">
              <input type="checkbox" id="editIncludePassive" />
              <span class="toggle-track"
                ><span class="toggle-thumb"></span
              ></span>
            </label>
          </div>
          <div class="sm:col-span-2">
            <label for="editAssetTaxTreatment" class="form-label">
              Tax treatment for UK forecasts
            </label>
            <select id="editAssetTaxTreatment" class="input-field">
              <option value="tax-free">Tax-free or sheltered (ISA, pension)</option>
              <option value="income">Taxed as income (interest, rent, bond coupons)</option>
              <option value="dividend">Taxed as dividends</option>
              <option value="capital-gains">Capital gains tax on sale</option>
            </select>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
              Matches the options on the add asset form and controls how UK tax is applied.
            </p>
          </div>
          <div>
            <label for="editLowGrowth" class="form-label">Low Growth (%)</label>
            <input
              type="number"
              step="any"
              id="editLowGrowth"
              class="input-field"
            />
          </div>
          <div>
            <label for="editAssetReturn" class="form-label"
              >Expected Return (%)</label
            >
            <input
              type="number"
              step="any"
              id="editAssetReturn"
              class="input-field"
            />
          </div>
          <div>
            <label for="editHighGrowth" class="form-label"
              >High Growth (%)</label
            >
            <input
              type="number"
              step="any"
              id="editHighGrowth"
              class="input-field"
            />
          </div>

          <div class="sm:col-span-2 mt-4 flex justify-end gap-3">
            <button type="button" class="btn btn-gray" data-close>
              Cancel
            </button>
            <button type="submit" class="btn btn-green">Save Changes</button>
          </div>
        </form>
      </div>
    </template>

    <template id="tpl-edit-liability">
      <div>
        <h4 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-4">Edit Liability</h4>
        <form
          id="editLiabilityFormModal"
          class="grid grid-cols-1 md:gap-4 gap-2"
        >
          <input type="hidden" id="editLiabilityIndex" />
          <div class="md:col-span-full">
            <label for="editLiabilityName" class="form-label required-label"
              >Liability Name</label
            >
            <input
              type="text"
              id="editLiabilityName"
              class="input-field"
              required
            />
          </div>
          <div class="md:col-span-full">
            <label for="editLiabilityValue" class="form-label required-label"
              >Amount Owed (<span data-currency-symbol>£</span>)</label
            >
            <input
              type="number"
              step="any"
              id="editLiabilityValue"
              class="input-field"
              required
            />
          </div>
          <div class="md:col-span-full">
            <label for="editLiabilityInterest" class="form-label"
              >Annual Interest Rate (%)</label
            >
            <input
              type="number"
              step="any"
              id="editLiabilityInterest"
              class="input-field"
            />
          </div>
          <div class="md:col-span-full">
            <label for="editLiabilityPaymentAmount" class="form-label"
              >Recurring Payment (<span data-currency-symbol>£</span>)</label
            >
            <input
              type="number"
              step="any"
              id="editLiabilityPaymentAmount"
              class="input-field"
            />
          </div>
          <div class="md:col-span-full">
            <label for="editLiabilityPaymentFrequency" class="form-label"
              >Payment Frequency</label
            >
            <select id="editLiabilityPaymentFrequency" class="input-field">
              <option value="none">None</option>
              <option value="monthly">Monthly</option>
              <option value="quarterly">Quarterly</option>
              <option value="yearly">Yearly</option>
            </select>
          </div>
          <div class="md:col-span-full">
            <label for="editLiabilityStartDate" class="form-label"
              >Start Date</label
            >
            <input type="date" id="editLiabilityStartDate" class="input-field" />
          </div>
          <div class="md:col-span-full mt-4 flex justify-end gap-3">
            <button type="button" class="btn btn-gray" data-close>
              Cancel
            </button>
            <button type="submit" class="btn btn-green">Save Changes</button>
          </div>
        </form>
      </div>
    </template>

    <template id="tpl-edit-event">
      <div>
        <h4 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-4">Edit Event</h4>
        <form
          id="editEventForm"
          class="grid grid-cols-1 md:grid-cols-4 gap-2 md:gap-4"
        >
          <input type="hidden" id="editEventIndex" />
          <div>
            <label for="editEventName" class="form-label required-label"
              >Event Name</label
            >
            <input
              type="text"
              id="editEventName"
              class="input-field"
              required
            />
          </div>
          <div>
            <label for="editEventAmount" class="form-label required-label"
              >Amount</label
            >
            <div class="flex gap-2">
              <input
                type="number"
                step="any"
                id="editEventAmount"
                class="input-field"
                required
              />
              <select id="editEventType" class="input-field w-20">
                <option value="absolute" data-currency-symbol>£</option>
                <option value="percent">%</option>
              </select>
            </div>
          </div>
          <div>
            <label for="editEventDate" class="form-label required-label"
              >Date</label
            >
            <input
              type="date"
              id="editEventDate"
              class="input-field"
              required
            />
          </div>
          <div>
            <label for="editEventAsset" class="form-label"
              >Linked Asset (optional)</label
            >
            <select id="editEventAsset" class="input-field"></select>
          </div>
          <div class="md:col-span-4 mt-4 flex justify-end gap-3">
            <button type="button" class="btn btn-gray" data-close>
              Cancel
            </button>
            <button type="submit" class="btn btn-green">Save Changes</button>
          </div>
        </form>
      </div>
    </template>

    <!-- One-off onboarding for Assets & Goals after "Start Now" -->
    <template id="tpl-onboard-data">
      <div class="p-4 sm:p-6 max-w-full break-words">
        <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3">Get started: Add your assets</h3>
        <p class="text-gray-700 dark:text-gray-300 mb-4">
          To build your forecast, add your assets and set a target on the
          Assets & Goals page.
        </p>
        <ul
          class="list-disc pl-5 space-y-2 text-gray-700 dark:text-gray-300 mb-4"
        >
          <li>
            Add each asset with an initial value and optional recurring
            deposits.
          </li>
          <li>
            Set expected growth rates (low / expected / high) for better
            scenarios.
          </li>
          <li>
            Set a wealth goal and target year to unlock Forecasts and track progress.
          </li>
          <li>
            Choose whether each asset counts toward
            <b>Estimated Passive Income</b> calculations.
          </li>
          <li>
            Use <b>one-off events (What-If)</b> on the Forecasts page to model
            bonuses, purchases, or unexpected losses (use negative amounts).
          </li>
          <li>
            Run stress tests from the Portfolio Insights page to simulate
            market volatility and see how it affects your goal timeline.
          </li>
        </ul>
        <div class="mt-4 flex gap-2 justify-end">
          <button class="btn btn-gray" data-action="close-modal">Close</button>
          <button class="btn btn-gray" data-action="focus-goal">Set Goal</button>
          <button class="btn btn-green" data-action="focus-asset-form">
            Add First Asset
          </button>
        </div>
      </div>
    </template>

    <!-- One-off onboarding for Forecasts when unlocked -->
    <template id="tpl-onboard-forecast">
      <div class="p-4 sm:p-6 max-w-full break-words">
        <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3">Explore your forecast</h3>
        <p class="text-gray-700 dark:text-gray-300 mb-4">
          The Forecasts page projects your wealth over time using your assets, goal, and target year.
        </p>
        <ul class="list-disc pl-5 space-y-2 text-gray-700 dark:text-gray-300 mb-4">
          <li>Use the chart to see low, expected, and high scenarios.</li>
          <li>Add one-off events to model future gains or expenses.</li>
          <li>Check saved snapshots against today's forecast with Progress Check.</li>
        </ul>
        <div class="mt-4 flex justify-end">
          <button class="btn btn-green" data-action="close-modal">Got it</button>
        </div>
      </div>
    </template>

    <!-- Quick tour modal -->
    <template id="tpl-quick-tour">
      <div class="p-4 sm:p-6 max-w-full break-words">
        <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3">Quick tour (30 seconds)</h3>
        <ul class="list-disc pl-5 space-y-2 text-gray-700 dark:text-gray-300 mb-4">
          <li><b>Assets & Goals</b>: add assets, set growth, and choose a target.</li>
          <li><b>Forecasts</b>: project your wealth, add one-off events.</li>
          <li><b>Portfolio Insights</b>: see allocation, passive income, and stress tests.</li>
          <li><b>Snapshots</b>: save totals to compare progress over time.</li>
          <li><b>Settings & Data</b>: profiles, theme, and export/import.</li>
        </ul>
        <div class="flex flex-wrap gap-2 justify-end">
          <button class="btn btn-gray" data-action="go-assets">Open Assets & Goals</button>
          <button class="btn btn-blue" data-action="go-forecasts">Open Forecasts</button>
          <button class="btn btn-gray" data-action="go-insights">Portfolio Insights</button>
          <button class="btn btn-gray" data-action="go-settings">Settings & Data</button>
          <button class="btn btn-green" data-action="close-modal">Close</button>
        </div>
      </div>
    </template>

    <!-- One-off tip: Profiles onboarding -->
    <script src="assets/js/app.js"></script>
  </body>
</html>
